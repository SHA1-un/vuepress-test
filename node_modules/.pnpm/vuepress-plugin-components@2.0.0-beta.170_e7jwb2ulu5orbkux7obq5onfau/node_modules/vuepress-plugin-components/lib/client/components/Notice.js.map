{"version":3,"file":"Notice.js","sources":["../../../src/client/components/icons.ts","../../../src/client/components/NoticeItem.ts","../../../src/client/components/Notice.ts"],"sourcesContent":["import { h } from \"vue\";\nimport { IconBase } from \"vuepress-shared/client\";\n\nimport type { FunctionalComponent } from \"vue\";\n\nexport const BackToTopIcon: FunctionalComponent = () =>\n  h(IconBase, { name: \"back-to-top\" }, () => [\n    h(\"path\", {\n      d: \"M512 843.2c-36.2 0-66.4-13.6-85.8-21.8-10.8-4.6-22.6 3.6-21.8 15.2l7 102c.4 6.2 7.6 9.4 12.6 5.6l29-22c3.6-2.8 9-1.8 11.4 2l41 64.2c3 4.8 10.2 4.8 13.2 0l41-64.2c2.4-3.8 7.8-4.8 11.4-2l29 22c5 3.8 12.2.6 12.6-5.6l7-102c.8-11.6-11-20-21.8-15.2-19.6 8.2-49.6 21.8-85.8 21.8z\",\n    }),\n    h(\"path\", {\n      d: \"m795.4 586.2-96-98.2C699.4 172 513 32 513 32S324.8 172 324.8 488l-96 98.2c-3.6 3.6-5.2 9-4.4 14.2L261.2 824c1.8 11.4 14.2 17 23.6 10.8L419 744s41.4 40 94.2 40c52.8 0 92.2-40 92.2-40l134.2 90.8c9.2 6.2 21.6.6 23.6-10.8l37-223.8c.4-5.2-1.2-10.4-4.8-14zM513 384c-34 0-61.4-28.6-61.4-64s27.6-64 61.4-64c34 0 61.4 28.6 61.4 64S547 384 513 384z\",\n    }),\n  ]);\n\nBackToTopIcon.displayName = \"BackToTopIcon\";\n\nexport const CloseIcon: FunctionalComponent = () =>\n  h(IconBase, { name: \"close\" }, () =>\n    h(\"path\", {\n      d: \"m925.468 822.294-303.27-310.288L925.51 201.674c34.683-27.842 38.3-75.802 8.122-107.217-30.135-31.37-82.733-34.259-117.408-6.463L512.001 399.257 207.777 87.993C173.1 60.197 120.504 63.087 90.369 94.456c-30.179 31.415-26.561 79.376 8.122 107.217L401.8 512.005l-303.27 310.29c-34.724 27.82-38.34 75.846-8.117 107.194 30.135 31.437 82.729 34.327 117.408 6.486L512 624.756l304.177 311.22c34.68 27.84 87.272 24.95 117.408-6.487 30.223-31.348 26.56-79.375-8.118-107.195z\",\n    })\n  );\n\nCloseIcon.displayName = \"CloseIcon\";\n","import { isLinkHttp } from \"@vuepress/shared\";\nimport {\n  TransitionGroup,\n  computed,\n  defineComponent,\n  h,\n  onMounted,\n  ref,\n} from \"vue\";\nimport { useRoute, useRouter } from \"vue-router\";\nimport { isAbsoluteUrl } from \"vuepress-shared/client\";\n\nimport { CloseIcon } from \"./icons.js\";\n\nimport type { PropType, VNode } from \"vue\";\nimport type { NoticeActionOption } from \"../../shared/index.js\";\n\nimport \"../styles/notice.scss\";\n\nexport default defineComponent({\n  name: \"NoticeItem\",\n\n  props: {\n    /**\n     * Notice path\n     *\n     * 通知路径\n     */\n    path: {\n      type: String,\n      default: \"\",\n    },\n\n    /**\n     * Notice match RegExp\n     *\n     * 通知路径匹配\n     */\n    match: {\n      type: String,\n      default: \"\",\n    },\n\n    /**\n     * Notice title\n     *\n     * 通知标题\n     */\n    title: {\n      type: String,\n      required: true,\n    },\n\n    /**\n     * Notice content\n     *\n     * 通知内容\n     */\n    content: {\n      type: String,\n      required: true,\n    },\n\n    /**\n     * Notice footer\n     *\n     * 通知操作\n     */\n    actions: {\n      type: Array as PropType<NoticeActionOption[]>,\n      default: (): NoticeActionOption[] => [],\n    },\n\n    /**\n     * Notice key\n     *\n     * 通知 key\n     */\n    noticeKey: {\n      type: String,\n      default: \"\",\n    },\n\n    /**\n     * Whether show notice only showOnce\n     *\n     * 是否仅展示一次通知\n     */\n    showOnce: Boolean,\n\n    /**\n     * Whether the notice shall be confirmed\n     *\n     * 通知是否需要确认\n     */\n    confirm: Boolean,\n\n    /**\n     * Whether display notice fullscreen\n     *\n     * 是否全屏显示通知\n     */\n    fullscreen: Boolean,\n  },\n\n  setup(props) {\n    const route = useRoute();\n    const router = useRouter();\n\n    const isVisible = ref(false);\n\n    const key = computed(() =>\n      props.noticeKey\n        ? `notice-${props.noticeKey}`\n        : `${props.title}${props.content}`\n    );\n\n    const isMatched = computed(() =>\n      props.match\n        ? new RegExp(props.match).test(route.path)\n        : route.path.startsWith(props.path)\n    );\n\n    onMounted(() => {\n      const hasBeenClosed = (\n        props.showOnce ? localStorage : sessionStorage\n      ).getItem(key.value);\n\n      isVisible.value = !hasBeenClosed;\n    });\n\n    const close = (): void => {\n      isVisible.value = false;\n      (props.showOnce ? localStorage : sessionStorage).setItem(\n        \"v2-notice\",\n        \"true\"\n      );\n    };\n\n    const openLink = (link?: string): void => {\n      if (link) {\n        if (isAbsoluteUrl(link)) void router.push(link);\n        else if (isLinkHttp(link)) window.open(link);\n      }\n      close();\n    };\n\n    return (): VNode =>\n      h(TransitionGroup, { name: \"notice-fade\" }, () =>\n        isMatched.value && isVisible.value\n          ? [\n              props.fullscreen\n                ? h(\"div\", {\n                    key: \"mask\",\n                    class: \"notice-mask\",\n                    onClick: () => {\n                      if (!props.confirm) close();\n                    },\n                  })\n                : null,\n              h(\n                \"div\",\n                {\n                  key: \"popup\",\n                  class: [\"notice-wrapper\", { fullscreen: props.fullscreen }],\n                },\n                [\n                  h(\"header\", { class: \"notice-title\" }, [\n                    props.confirm\n                      ? null\n                      : h(CloseIcon, { onClick: (): void => close() }),\n                    h(\"span\", { innerHTML: props.title }),\n                  ]),\n                  h(\"div\", {\n                    class: \"notice-content\",\n                    innerHTML: props.content,\n                  }),\n                  h(\n                    \"div\",\n                    { class: \"notice-footer\" },\n                    props.actions.map(({ text, link, type = \"\" }) =>\n                      h(\"button\", {\n                        class: [\"notice-footer-action\", type],\n                        onClick: () => openLink(link),\n                        innerHTML: text,\n                      })\n                    )\n                  ),\n                ]\n              ),\n            ]\n          : []\n      );\n  },\n});\n","import { h } from \"vue\";\nimport { useRoute } from \"vue-router\";\n\nimport NoticeItem from \"./NoticeItem.js\";\n\nimport type { FunctionalComponent, PropType } from \"vue\";\nimport type { NoticeItemOptions } from \"../../shared/index.js\";\n\nimport \"../styles/notice.scss\";\n\ntype NoticeClientOption = Omit<NoticeItemOptions, \"key\"> & {\n  noticeKey?: string;\n} & ({ path: string } | { match: string });\n\nconst Notice: FunctionalComponent<{\n  config: NoticeClientOption[];\n}> = ({ config }) => {\n  const route = useRoute();\n\n  const item = config.find((item) =>\n    \"match\" in item\n      ? new RegExp(item.match).test(route.path)\n      : route.path.startsWith(item.path)\n  );\n\n  return item ? h(NoticeItem, item) : null;\n};\n\nNotice.displayName = \"Notice\";\nNotice.props = {\n  /**\n   * Notice locales settings\n   *\n   * 通知的多语言设置\n   */\n  config: {\n    type: Array as PropType<NoticeClientOption[]>,\n    required: true,\n  },\n};\n\nexport default Notice;\n"],"names":["CloseIcon","h","IconBase","defineComponent","props","route","useRoute","router","useRouter","isVisible","ref","key","computed","isMatched","onMounted","hasBeenClosed","close","openLink","link","isAbsoluteUrl","isLinkHttp","TransitionGroup","text","type","Notice","config","item","NoticeItem"],"mappings":"8SAiBa,MAAAA,EAAiC,IAC5CC,EAAEC,EAAU,CAAE,KAAM,OAAQ,EAAG,IAC7BD,EAAE,OAAQ,CACR,EAAG,idACL,CAAC,CACH,EAEFD,EAAU,YAAc,YCLxB,IAAeG,EAAAA,EAAgB,CAC7B,KAAM,aAEN,MAAO,CAML,KAAM,CACJ,KAAM,OACN,QAAS,EACX,EAOA,MAAO,CACL,KAAM,OACN,QAAS,EACX,EAOA,MAAO,CACL,KAAM,OACN,SAAU,EACZ,EAOA,QAAS,CACP,KAAM,OACN,SAAU,EACZ,EAOA,QAAS,CACP,KAAM,MACN,QAAS,IAA4B,CAAA,CACvC,EAOA,UAAW,CACT,KAAM,OACN,QAAS,EACX,EAOA,SAAU,QAOV,QAAS,QAOT,WAAY,OACd,EAEA,MAAMC,EAAO,CACX,MAAMC,EAAQC,EACRC,EAAAA,EAASC,IAETC,EAAYC,EAAI,EAAK,EAErBC,EAAMC,EAAS,IACnBR,EAAM,UACF,UAAUA,EAAM,YAChB,GAAGA,EAAM,QAAQA,EAAM,SAC7B,EAEMS,EAAYD,EAAS,IACzBR,EAAM,MACF,IAAI,OAAOA,EAAM,KAAK,EAAE,KAAKC,EAAM,IAAI,EACvCA,EAAM,KAAK,WAAWD,EAAM,IAAI,CACtC,EAEAU,EAAU,IAAM,CACd,MAAMC,GACJX,EAAM,SAAW,aAAe,gBAChC,QAAQO,EAAI,KAAK,EAEnBF,EAAU,MAAQ,CAACM,CACrB,CAAC,EAED,MAAMC,EAAQ,IAAY,CACxBP,EAAU,MAAQ,IACjBL,EAAM,SAAW,aAAe,gBAAgB,QAC/C,YACA,MACF,CACF,EAEMa,EAAYC,GAAwB,CACpCA,IACEC,EAAcD,CAAI,EAAQX,EAAO,KAAKW,CAAI,EACrCE,EAAWF,CAAI,GAAG,OAAO,KAAKA,CAAI,GAE7CF,EAAM,CACR,EAEA,MAAO,IACLf,EAAEoB,EAAiB,CAAE,KAAM,aAAc,EAAG,IAC1CR,EAAU,OAASJ,EAAU,MACzB,CACEL,EAAM,WACFH,EAAE,MAAO,CACP,IAAK,OACL,MAAO,cACP,QAAS,IAAM,CACRG,EAAM,SAASY,GACtB,CACF,CAAC,EACD,KACJf,EACE,MACA,CACE,IAAK,QACL,MAAO,CAAC,iBAAkB,CAAE,WAAYG,EAAM,UAAW,CAAC,CAC5D,EACA,CACEH,EAAE,SAAU,CAAE,MAAO,cAAe,EAAG,CACrCG,EAAM,QACF,KACAH,EAAED,EAAW,CAAE,QAAS,IAAYgB,EAAQ,CAAA,CAAC,EACjDf,EAAE,OAAQ,CAAE,UAAWG,EAAM,KAAM,CAAC,CACtC,CAAC,EACDH,EAAE,MAAO,CACP,MAAO,iBACP,UAAWG,EAAM,OACnB,CAAC,EACDH,EACE,MACA,CAAE,MAAO,eAAgB,EACzBG,EAAM,QAAQ,IAAI,CAAC,CAAE,KAAAkB,EAAM,KAAAJ,EAAM,KAAAK,EAAO,EAAG,IACzCtB,EAAE,SAAU,CACV,MAAO,CAAC,uBAAwBsB,CAAI,EACpC,QAAS,IAAMN,EAASC,CAAI,EAC5B,UAAWI,CACb,CAAC,CACH,CACF,CACF,CACF,CACF,EACA,CACN,CAAA,CACJ,CACF,CAAC,ECpLD,MAAME,EAED,CAAC,CAAE,OAAAC,CAAO,IAAM,CACnB,MAAMpB,EAAQC,IAERoB,EAAOD,EAAO,KAAMC,GACxB,UAAWA,EACP,IAAI,OAAOA,EAAK,KAAK,EAAE,KAAKrB,EAAM,IAAI,EACtCA,EAAM,KAAK,WAAWqB,EAAK,IAAI,CACrC,EAEA,OAAOA,EAAOzB,EAAE0B,EAAYD,CAAI,EAAI,IACtC,EAEAF,EAAO,YAAc,SACrBA,EAAO,MAAQ,CAMb,OAAQ,CACN,KAAM,MACN,SAAU,EACZ,CACF"}