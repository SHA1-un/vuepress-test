import{usePageLang as k}from"@vuepress/client";import{ref as b,computed as z,unref as v,onMounted as S,isRef as N,watch as L,defineComponent as A,nextTick as R,onBeforeUnmount as x,h as O,camelize as P}from"vue";import{isString as T}from"@vuepress/shared";import{useEventListener as E}from"@vueuse/core";const M=e=>T(e)?e:`${e}px`,D=(e,t=0)=>{const a=b(),o=z(()=>M(v(e.width)||"100%")),n=b("auto"),y=c=>{if(T(c)){const[i,l]=c.split(":"),d=Number(i)/Number(l);if(!Number.isNaN(d))return d}return typeof c=="number"?c:16/9},u=c=>{const i=v(e.height),l=y(v(e.ratio));return i?M(i):`${Number(c)/l+v(t)}px`},p=()=>{a.value&&(n.value=u(a.value.clientWidth))};return S(()=>{p(),N(t)&&L(t,()=>p()),E("orientationchange",()=>p()),E("resize",()=>p())}),{el:a,width:o,height:n}},U=["mp4","mp3","webm","ogg","m3u8","hls","ts","flv","mpd","dash"],_=e=>(e==null?void 0:e.split(".").pop())||"",C=async(e,t,a,o=!1,n=0)=>{const y=(await import("dashjs/dist/dash.all.min.js")).default;if(y.supportsMediaSource()){const u=y.MediaPlayer().create();u.initialize(e,t,o,n),a(()=>u.destroy())}},B=async(e,t,a)=>{const o=(await import("mpegts.js/dist/mpegts.js")).default;if(o.isSupported()){const n=o.createPlayer({type:"flv",url:t});n.attachMediaElement(e),n.load(),a(()=>n.destroy())}},H=async(e,t,a)=>{const o=(await import("hls.js/dist/hls.min.js")).default;if(e.canPlayType("application/x-mpegURL")||e.canPlayType("application/vnd.apple.mpegURL"))e.src=t;else if(o.isSupported()){const n=new o;n.attachMedia(e),n.on(o.Events.MEDIA_ATTACHED,function(){n.loadSource(t)}),a(()=>n.destroy())}},I=["no-fullscreen","no-hotkey","no-playback-rate","no-setting","no-mutex","no-plays-inline"],$=["airplay","autoplay","aspect-ratio","auto-mini","auto-size","auto-orientation","auto-playback","fast-forward","flip","fullscreen-web","lock","loop","is-live","muted","mini-progress-bar","pip","screenshot","subtitle-offset"],j=["en","pl","cs","es","fa"],F=["zh-cn","zh-tw"],Y=e=>{const t=e.toLowerCase(),a=t.split("-")[0];return F.includes(t)?t:j.includes(a)?a:a==="zh"?"zh-cn":"en"};var q=A({name:"ArtPlayer",props:{src:{type:String,required:!0},type:{type:String,default:""},poster:{type:String,default:""},title:{type:String,default:""},width:{type:[String,Number],default:"100%"},height:{type:[String,Number],default:void 0},ratio:{type:[String,Number],default:16/9},config:{type:Object,default:null},customPlayer:{type:Function,default:e=>e}},setup(e,{attrs:t}){const a=k(),{el:o,width:n,height:y}=D(e,0),u=b("Loading...");let p;const c=()=>{var i,l,d;const r={theme:"#3eaf7c",...ART_PLAYER_OPTIONS,container:o.value,title:e.title,poster:e.poster,url:e.src,type:e.type||_(e.src),lang:Y(a.value),...e.config,useSSR:!0},w=Object.keys(t);if(I.forEach(s=>{w.includes(s)&&(r[P(s.replace(/^no-/,""))]=!1)}),$.forEach(s=>{w.includes(s)&&(r[P(s)]=!0)}),r.type){const s=r.customType??(r.customType={});if(U.includes(r.type.toLowerCase()))switch(r.type){case"m3u8":case"hls":s[i=r.type]??(s[i]=(f,m,h)=>H(f,m,g=>{h.on("destroy",g)}));break;case"flv":s[l=r.type]??(s[l]=(f,m,h)=>B(f,m,g=>{h.on("destroy",g)}));break;case"mpd":case"dash":s[d=r.type]??(s[d]=(f,m,h)=>C(f,m,g=>{h.on("destroy",g)}));break}else console.warn(`[components]: ArtPlayer does not support current file type ${r.type}!`)}return r};return S(()=>{import("artplayer").then(async({default:i})=>(u.value=i.html,R().then(async()=>{const l=new i(c());p=await e.customPlayer(l)||l})))}),x(()=>{p==null||p.destroy()}),()=>O("div",{ref:o,style:{width:n.value,height:y.value},innerHTML:u.value})}});export{q as default};
//# sourceMappingURL=ArtPlayer.js.map
